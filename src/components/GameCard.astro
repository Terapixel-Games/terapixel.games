---
import type { Game } from '../types';

interface Props {
  game: Game;
  playMode?: 'detail' | 'fullscreen';
}

const { game, playMode = 'detail' } = Astro.props;
const detailHref = `/${game.slug}`;
const isPlayable = Boolean(game.embedUrl || game.fullScreenUrl) && !game.isComingSoon;
const playHref = playMode === 'fullscreen' && game.fullScreenUrl ? game.fullScreenUrl : detailHref;
const playTarget = playMode === 'fullscreen' && game.fullScreenUrl ? '_blank' : undefined;
const playRel = playMode === 'fullscreen' && game.fullScreenUrl ? 'noreferrer noopener' : undefined;
---

<article class="game-card">
  {
    isPlayable ? (
      <a href={detailHref} class="game-card-media-link">
        <img
          src={game.image}
          alt={game.title}
          class="game-card-media"
          loading="lazy"
          onerror="this.onerror=null;this.src='/images/placeholder-game.svg';"
        />
        <span class="game-card-overlay" aria-hidden="true"></span>
      </a>
    ) : (
      <div class="game-card-media-link">
        <img
          src={game.image}
          alt={game.title}
          class="game-card-media"
          loading="lazy"
          onerror="this.onerror=null;this.src='/images/placeholder-game.svg';"
        />
        <span class="game-card-overlay" aria-hidden="true"></span>
      </div>
    )
  }

  <div class="game-card-content">
    <h2>{game.title}</h2>
    <div class="game-card-actions">
      {
        isPlayable ? (
          <a href={playHref} target={playTarget} rel={playRel} class="btn btn-primary">
            Play Now
          </a>
        ) : (
          <span class="chip muted">Coming Soon</span>
        )
      }
      <a href={detailHref} class="btn btn-secondary">Details</a>
    </div>
  </div>
</article>
