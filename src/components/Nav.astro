---
const { pathname = '/' } = Astro.props;

const logoUrl =
  'https://lh3.googleusercontent.com/sitesv/APaQ0SQpb2N1PxGF7N9Iepr_9UbAKup_lJOLK5xjljlAfp4tEhTkxYPqfdu14ETCaiX-pzs4EswA481TbQqKx00S_xDyTkmafajnzGMW6mSLlXTD9HgchqxI_cqpCsNb0_yE13WADpRMlGVrHle3pEVGZwezAW989u6JHGE9Xr8SgvJpIfC-yY4o0ClcwiQ=w16383';

const links = [
  { href: '/', label: 'Home' },
  { href: '/games', label: 'Games' },
  { href: '/shop', label: 'Shop' },
  { href: '/support', label: 'Support' }
];

const staticPaths = new Set(['/', '/games', '/shop', '/account', '/support', '/privacy-policy', '/contact']);
const normalizedPath = pathname.endsWith('/') && pathname !== '/' ? pathname.slice(0, -1) : pathname;
const isGameDetail = /^\/[^/]+$/.test(normalizedPath) && !staticPaths.has(normalizedPath);
const accountActive = normalizedPath === '/account';
---

<header class="site-header">
  <div class="shell">
    <div class="topbar">
      <a href="/" class="brand" aria-label="Terapixel Games Home">
        <img
          src={logoUrl}
          alt=""
          class="brand-mark"
          loading="eager"
          onerror="this.style.display='none';"
        />
        <span class="brand-name">Terapixel Games</span>
      </a>
      <button id="tpx-auth-open" type="button" class="auth-open">
        Login
      </button>
    </div>
    <nav aria-label="Primary" class="primary-nav">
      <ul class="nav-links">
        {
          links.map((link) => {
            const active =
              normalizedPath === link.href ||
              (link.href === '/games' && (normalizedPath === '/games' || isGameDetail));
            return (
              <li>
                <a href={link.href} class="nav-link" aria-current={active ? 'page' : undefined}>
                  {link.label}
                </a>
              </li>
            );
          })
        }
        <li id="tpx-account-nav" class="hidden">
          <a href="/account" class="nav-link" aria-current={accountActive ? 'page' : undefined}>
            Account
          </a>
        </li>
      </ul>
      <div class="auth-caption">
        <span id="tpx-auth-label" class="auth-label hidden"></span>
      </div>
    </nav>
  </div>
</header>

<div id="tpx-auth-modal" class="hidden modal-overlay" role="dialog" aria-modal="true" aria-labelledby="tpx-auth-title">
  <div class="modal-card">
    <div class="modal-head">
      <h2 id="tpx-auth-title">Terapixel Account</h2>
      <button id="tpx-auth-close" type="button" class="modal-close">Close</button>
    </div>
    <p id="tpx-auth-status" class="modal-status">Enter email and continue to login.</p>
    <input
      id="tpx-auth-email"
      type="email"
      autocomplete="email"
      placeholder="you@example.com"
      class="modal-input"
    />
    <div class="modal-actions">
      <button id="tpx-auth-submit" type="button" class="btn btn-primary">
        Continue Login
      </button>
      <button id="tpx-auth-logout" type="button" class="btn btn-secondary hidden">
        Logout
      </button>
    </div>
  </div>
</div>
